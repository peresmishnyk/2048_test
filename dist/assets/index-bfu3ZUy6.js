(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))f(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&f(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function f(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const k=document.getElementById("game-board"),c=4;let u=[],x=[],H=0,B=!1,L=!1;function se(){H=0,B=!1,L=!1,Y();const o=document.getElementById("game-over-message");o&&o.remove(),k.querySelectorAll(".grid-cell").forEach(f=>f.remove()),k.querySelectorAll(".tile").forEach(f=>f.remove());for(let f=0;f<c*c;f++){const t=document.createElement("div");t.classList.add("grid-cell"),k.appendChild(t)}u=Array(c).fill(null).map(()=>Array(c).fill(0)),x=Array(c).fill(null).map(()=>Array(c).fill(null)),ne(),ne(),ee()}function ne(){if(B)return;let o=[];for(let e=0;e<c;e++)for(let r=0;r<c;r++)u[e][r]===0&&o.push({r:e,c:r});if(o.length>0){const{r:e,c:r}=o[Math.floor(Math.random()*o.length)];u[e][r]=Math.random()<.9?2:4}else q()||F()}function ee(){const f=((k.clientWidth||400)-2*10-(c-1)*10)/c;k.querySelectorAll(".tile").forEach(i=>i.remove());for(let i=0;i<c;i++)for(let n=0;n<c;n++)u[i][n]!==0&&ie(i,n,u[i][n],f,10,10)}function ie(o,e,r,f,t,i){const n=document.createElement("div");n.classList.add("tile"),n.classList.add(`tile-${r}`),n.textContent=r,n.style.width=`${f}px`,n.style.height=`${f}px`,n.style.top=`${o*(f+t)+i}px`,n.style.left=`${e*(f+t)+i}px`,k.appendChild(n),x[o][e]=n}function me(){const o=document.styleSheets[0],e={2:{background:"#eee4da",color:"#776e65"},4:{background:"#ede0c8",color:"#776e65"},8:{background:"#f2b179",color:"#f9f6f2"},16:{background:"#f59563",color:"#f9f6f2"},32:{background:"#f67c5f",color:"#f9f6f2"},64:{background:"#f65e3b",color:"#f9f6f2"},128:{background:"#edcf72",color:"#f9f6f2"},256:{background:"#edcc61",color:"#f9f6f2"},512:{background:"#edc850",color:"#f9f6f2"},1024:{background:"#edc53f",color:"#f9f6f2"},2048:{background:"#edc22e",color:"#f9f6f2"}};for(const[r,f]of Object.entries(e)){const t=`.tile-${r}`,i=`background-color: ${f.background}; color: ${f.color};`;o.insertRule(`${t} { ${i} }`,o.cssRules.length),r>=1024?o.insertRule(`${t} { font-size: 40px; }`,o.cssRules.length):r>=128&&o.insertRule(`${t} { font-size: 45px; }`,o.cssRules.length)}}function ge(o,e){const f={2:{background:"#eee4da",color:"#776e65"},4:{background:"#ede0c8",color:"#776e65"},8:{background:"#f2b179",color:"#f9f6f2"},16:{background:"#f59563",color:"#f9f6f2"},32:{background:"#f67c5f",color:"#f9f6f2"},64:{background:"#f65e3b",color:"#f9f6f2"},128:{background:"#edcf72",color:"#f9f6f2"},256:{background:"#edcc61",color:"#f9f6f2"},512:{background:"#edc850",color:"#f9f6f2"},1024:{background:"#edc53f",color:"#f9f6f2"},2048:{background:"#edc22e",color:"#f9f6f2"}}[e]||{background:"#3c3a32",color:"#f9f6f2"};o.style.backgroundColor=f.background,o.style.color=f.color,e>=1024?o.style.fontSize="40px":e>=128?o.style.fontSize="45px":o.style.fontSize="55px"}function oe(o){const e=[],r=o.length;let f=0,t=o.map((l,p)=>l?{value:l,index:p,id:f++}:null),i=0,n=0;for(let l=0;l<r;l++)t[l]&&(l!==n&&(e.push({type:"move",from:t[l].index,to:n,value:t[l].value,id:t[l].id}),t[n]=t[l],t[l]=null),n++);for(let l=0;l<r-1;l++)if(t[l]&&t[l+1]&&t[l].value===t[l+1].value){const p=t[l].value*2;i+=p,e.push({type:"merge",from1:t[l].index,from2:t[l+1].index,to:l,value:p,id1:t[l].id,id2:t[l+1].id}),t[l].value=p,t[l+1]=null;for(let m=l+2;m<r;m++)if(t[m]){const b=m-1;let O=e.findIndex(G=>G.type==="move"&&G.id===t[m].id);O!==-1?e[O].to=b:t[m].index!==m?e.push({type:"move",from:t[m].index,to:b,value:t[m].value,id:t[m].id}):e.push({type:"move",from:m,to:b,value:t[m].value,id:t[m].id}),t[b]=t[m],t[m]=null}}const a=Array(r).fill(0);t.forEach((l,p)=>{l&&(a[p]=l.value)});const v=e.filter(l=>l.type==="move"?!e.some(m=>m.type==="merge"&&m.id2===l.id):!0);return{actions:v.filter(l=>l.type==="move"?!v.some(m=>m.type==="merge"&&m.id1===l.id):!0),finalRow:a,mergeScore:i}}function pe(o){if(B||L)return;let e=null;switch(o.key){case"ArrowUp":e=fe(u);break;case"ArrowDown":e=de(u);break;case"ArrowLeft":e=ae(u);break;case"ArrowRight":e=ce(u);break;default:return}e&&e.moved?ue(e.actions,e.finalGrid,e.scoreIncrease).catch(r=>{console.error("Animation failed:",r),L=!1,u=e.finalGrid,H+=e.scoreIncrease,ee(),Y(),!q()&&!W()&&F()}):!q()&&!W()&&F()}function ae(o){console.log("Calculating move left for grid:",JSON.parse(JSON.stringify(o)));let e=!1,r=0;const f=[],t=[];for(let i=0;i<c;i++){const n=o[i],a=oe(n);t.push(a.finalRow),r+=a.mergeScore,a.actions.forEach(v=>{console.log(`Row ${i}: Action calculated:`,v),f.push({...v,row:i}),e=!0}),!e&&n.join(",")!==a.finalRow.join(",")&&(console.log(`Row ${i} changed without actions?`,n,a.finalRow),e=!0)}return console.log("CalculateMoveLeft result:",{moved:e,finalGrid:t,actions:f,scoreIncrease:r}),{moved:e,finalGrid:t,actions:f,scoreIncrease:r}}function ce(o){console.log("Calculating move right...");let e=!1,r=0;const f=[],t=[];for(let i=0;i<c;i++){const n=o[i],a=[...n].reverse(),v=oe(a);t.push(v.finalRow.reverse()),r+=v.mergeScore,v.actions.forEach(g=>{e=!0;const l={...g,row:i,from:c-1-g.from,to:c-1-g.to,...g.type==="merge"&&{from1:c-1-g.from1,from2:c-1-g.from2}};console.log(`Row ${i}: Right Action calculated (translated):`,l),f.push(l)}),!e&&n.join(",")!==t[i].join(",")&&(e=!0)}return console.log("CalculateMoveRight result:",{moved:e,finalGrid:t,actions:f,scoreIncrease:r}),{moved:e,finalGrid:t,actions:f,scoreIncrease:r}}function fe(o){if(console.log("Calculating move up..."),!o||o.length!==c||o.some(a=>!a||a.length!==c))return console.error("calculateMoveUp received invalid currentGrid:",JSON.parse(JSON.stringify(o))),{moved:!1,finalGrid:o,actions:[],scoreIncrease:0};let e=!1,r=0;const f=[];let t=V(o);const i=[];for(let a=0;a<c;a++){if(!t||!t[a]){console.error(`calculateMoveUp error: Transposed grid missing column ${a}`,JSON.parse(JSON.stringify(t))),i.push(Array(c).fill(0));continue}const v=t[a],g=oe(v);i.push(g.finalRow),r+=g.mergeScore,g.actions.forEach(l=>{e=!0;const p={...l,row:l.from,col:a,targetRow:l.to,...l.type==="merge"&&{from1Row:l.from1,from2Row:l.from2}};console.log(`Col ${a}: Up Action calculated (translated):`,p),f.push(p)}),!e&&v.join(",")!==g.finalRow.join(",")&&(e=!0)}const n=V(i);return!n||n.length!==c||n.some(a=>!a||a.length!==c)?(console.error("calculateMoveUp resulted in invalid finalGrid after transpose:",JSON.parse(JSON.stringify(n)),"From:",JSON.parse(JSON.stringify(i))),{moved:!1,finalGrid:o,actions:[],scoreIncrease:0}):(console.log("CalculateMoveUp result:",{moved:e,finalGrid:n,actions:f,scoreIncrease:r}),{moved:e,finalGrid:n,actions:f,scoreIncrease:r})}function de(o){console.log("Calculating move down...");let e=!1,r=0;const f=[];let t=V(o);const i=[];for(let a=0;a<c;a++){const v=t[a],g=[...v].reverse(),l=oe(g);i.push(l.finalRow.reverse()),r+=l.mergeScore,l.actions.forEach(p=>{e=!0;const m=c-1-p.from,b=c-1-p.to,O=p.type==="merge"?c-1-p.from1:void 0,G=p.type==="merge"?c-1-p.from2:void 0,K={...p,row:m,col:a,targetRow:b,...p.type==="merge"&&{from1Row:O,from2Row:G}};console.log(`Col ${a}: Down Action calculated (translated):`,K),f.push(K)}),!e&&v.join(",")!==i[a].join(",")&&(e=!0)}const n=V(i);return console.log("CalculateMoveDown result:",{moved:e,finalGrid:n,actions:f,scoreIncrease:r}),{moved:e,finalGrid:n,actions:f,scoreIncrease:r}}async function ue(o,e,r){var G,K;if(L)return;L=!0,console.log("--- Starting animateMove ---",o);const f=[],t=new Map,i=[],n=10,a=10,g=((k.clientWidth||400)-2*a-(c-1)*n)/c;for(let s=0;s<c;s++)for(let d=0;d<c;d++)x[s][d];const l=x.map(s=>[...s]);o.forEach(s=>{var h,w,$;const{row:d,col:y}=s;if(s.type==="move"){const{from:I,to:te,value:Z,id:_,targetRow:Q}=s;let S,T,U;y!==void 0?(S=s.row,T=y,U=y):(S=d,T=I,U=te);const A=(h=l[S])==null?void 0:h[T];if(A){console.log(`Animating MOVE: Tile ${Z} from [${S},${T}] to [${Q!==void 0?Q:S},${U}]`,A);const J=`${(Q!==void 0?Q:S)*(g+n)+a}px`,D=`${U*(g+n)+a}px`;f.push(new Promise(N=>{const E=R=>{R.target===A&&(R.propertyName==="top"||R.propertyName==="left")&&(A.removeEventListener("transitionend",E),console.log(`Transition END for MOVE: Tile ${Z} at [${S},${T}] finished moving.`),N())};A.addEventListener("transitionend",E),setTimeout(()=>{A.removeEventListener("transitionend",E),N()},270)})),A.style.top=J,A.style.left=D}else console.warn(`Move action: Tile DOM element not found at start pos ${S}, ${T}`)}else if(s.type==="merge"){const{from1:I,from2:te,to:Z,value:_,id1:Q,id2:S,from1Row:T,from2Row:U,targetRow:A}=s;let J,D,N,E,R,j;y!==void 0?(J=T,D=y,N=U,E=y,R=y,j=A):(J=d,D=I,N=d,E=te,R=Z,j=d);const M=(w=l[J])==null?void 0:w[D],C=($=l[N])==null?void 0:$[E];if(M&&C){console.log(`Animating MERGE: Tile ${C.textContent} [${N},${E}] into Tile ${M.textContent} [${J},${D}] at [${j},${R}]`,M,C);const le=`${j*(g+n)+a}px`,re=`${R*(g+n)+a}px`;M.style.zIndex="10",C.style.zIndex="5",f.push(new Promise(X=>{const P=z=>{z.target===M&&(z.propertyName==="top"||z.propertyName==="left")&&(M.removeEventListener("transitionend",P),console.log(`Transition END for MERGE (tile1): Tile ${_} at [${j},${R}] finished.`),X())};M.addEventListener("transitionend",P),setTimeout(()=>{M.removeEventListener("transitionend",P),X()},270)})),f.push(new Promise(X=>{const P=z=>{z.target===C&&(z.propertyName==="top"||z.propertyName==="left")&&(C.removeEventListener("transitionend",P),console.log(`Transition END for MERGE (tile2): Tile ${_} at [${j},${R}] finished.`),X())};C.addEventListener("transitionend",P),setTimeout(()=>{C.removeEventListener("transitionend",P),X()},270)})),M.style.top=le,M.style.left=re,C.style.top=le,C.style.left=re,i.push(C),t.set(`${j},${R}`,{element:M,newValue:_})}else console.warn(`Merge action: Tile DOM elements not found at [${J},${D}] or [${N},${E}]`)}}),await Promise.all(f),console.log("--- All CSS transitions awaited ---"),console.log("Updating grid state, score, and DOM after animations."),u=e,H+=r,Y();const p=Array(c).fill(null).map(()=>Array(c).fill(null));t.forEach((s,d)=>{const[y,h]=d.split(",").map(Number);y>=0&&y<c&&h>=0&&h<c?(p[y][h]=s.element,s.element.className="tile",s.element.classList.add(`tile-${s.newValue}`),s.element.textContent=s.newValue,s.element.style.zIndex="1",ge(s.element,s.newValue)):console.error("Merged tile update out of bounds:",y,h)}),o.forEach(s=>{var d;if(s.type==="move"){let y,h,w,$;if(s.col!==void 0?(y=s.row,h=s.col,w=s.targetRow,$=s.col):(y=s.row,h=s.from,w=s.row,$=s.to),y>=0&&y<c&&h>=0&&h<c&&w>=0&&w<c&&$>=0&&$<c){const I=(d=l[y])==null?void 0:d[h];I?p[w][$]?console.warn(`Target [${w},${$}] already filled during moved tile placement.`):(p[w][$]=I,I.style.zIndex="1"):console.warn(`Post-animation: Moved tile element not found at original [${y}, ${h}]`)}else console.error("Moved tile action out of bounds:",{sourceRow:y,sourceCol:h,targetRow:w,targetCol:$})}});for(let s=0;s<c;s++)for(let d=0;d<c;d++)if(u[s][d]!==0&&!p[s][d]){const y=(G=l[s])==null?void 0:G[d];y&&y.textContent==u[s][d]?o.some(w=>w.type==="merge"&&(w.col!==void 0&&w.from2Row===s&&w.col===d||w.col===void 0&&w.row===s&&w.from2===d))?console.warn(`Tile at [${s},${d}] was detected as stationary but seems to have been merged away.`):(p[s][d]=y,y.style.zIndex="1"):console.error(`Post-animation: Unaccounted for tile at [${s},${d}] value ${u[s][d]}. CurrentDOM:`,y==null?void 0:y.textContent)}x=p,i.forEach(s=>s.remove()),console.log("[AnimateMove] Before addRandomTile grid:",JSON.parse(JSON.stringify(u))),ne(),console.log("[AnimateMove] After addRandomTile grid:",JSON.parse(JSON.stringify(u)));let m,b,O;e:for(let s=0;s<c;++s)for(let d=0;d<c;++d)if(u[s][d]!==0&&!x[s][d]){console.log(`[AnimateMove] New tile data found in grid at [${s},${d}] with value ${u[s][d]}`),m=s,b=d,O=u[s][d];break e}if(m!==void 0){console.log(`[AnimateMove] Creating DOM element for new tile at [${m},${b}], value ${O}`);const s=ie(m,b,O,g,n,a);console.log("[AnimateMove] New tile DOM element created:",s,"tiles array updated?",((K=x[m])==null?void 0:K[b])===s),s?(s.classList.add("tile-new"),console.log("[AnimateMove] Added .tile-new class for appearance animation."),setTimeout(()=>{s&&s.parentNode?(console.log(`[AnimateMove] Removing .tile-new class for new tile at [${m},${b}]`),s.classList.remove("tile-new")):console.warn(`[AnimateMove] New tile element at [${m},${b}] no longer exists when removing .tile-new class.`)},250)):console.error("[AnimateMove] createTile returned null/undefined for the new tile.")}else console.error("[AnimateMove] Could not find the position of the newly added random tile in the grid/tiles comparison."),console.log("[AnimateMove] Final grid state when new tile not found:",JSON.parse(JSON.stringify(u))),console.log("[AnimateMove] Final tiles DOM state when new tile not found:",x);!q()&&!W()&&F(),console.log("--- Animation complete. isAnimating = false. Final tiles array: ---",x),L=!1}function V(o){if(!o||o.length===0||!o[0]||o.some(e=>!e||e.length!==o[0].length))return console.error("transposeGrid called with invalid matrix:",JSON.parse(JSON.stringify(o))),Array(c).fill(null).map(()=>Array(c).fill(0));try{return o[0].map((e,r)=>o.map(f=>f[r]))}catch(e){return console.error("Error during transposeGrid execution:",e,"Input matrix:",JSON.parse(JSON.stringify(o))),Array(c).fill(null).map(()=>Array(c).fill(0))}}function W(){for(let o=0;o<c;o++)for(let e=0;e<c;e++)if(u[o][e]===0)return!0;return!1}function q(){for(let o=0;o<c;o++)for(let e=0;e<c-1;e++)if(u[o][e]===u[o][e+1])return!0;for(let o=0;o<c;o++)for(let e=0;e<c-1;e++)if(u[e][o]===u[e+1][o])return!0;return!!W()}function F(){B=!0,console.log("Game Over!");const o=document.createElement("div");o.id="game-over-message",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(238, 228, 218, 0.73)",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.zIndex="100";const e=document.createElement("p");e.textContent="Game Over!",e.style.fontSize="40px",e.style.fontWeight="bold",e.style.color="#776e65",e.style.margin="0 0 20px 0";const r=document.createElement("button");r.textContent="Restart Game",r.style.padding="10px 20px",r.style.fontSize="18px",r.style.backgroundColor="#8f7a66",r.style.color="#f9f6f2",r.style.border="none",r.style.borderRadius="3px",r.style.cursor="pointer",r.onclick=()=>{se()},o.appendChild(e),o.appendChild(r),k.appendChild(o)}function Y(){const o=document.getElementById("score");o.textContent=H}function ye(o){const e=JSON.parse(JSON.stringify(u));let r=0,f=!1;const t=n=>{let a=n.filter(l=>l!==0),v=0;for(let l=0;l<a.length-1;l++)a[l]===a[l+1]&&(a[l]*=2,v+=a[l],a.splice(l+1,1));const g=Array(c).fill(0);return a.forEach((l,p)=>g[p]=l),{newRow:g,mergeScore:v}};if(o==="left")for(let n=0;n<c;n++){const a=t(e[n]);e[n].join(",")!==a.newRow.join(",")&&(f=!0),r+=a.mergeScore,e[n]=a.newRow}else if(o==="right")for(let n=0;n<c;n++){const a=[...e[n]].reverse(),v=t(a),g=v.newRow.reverse();e[n].join(",")!==g.join(",")&&(f=!0),r+=v.mergeScore,e[n]=g}else if(o==="up"||o==="down"){let n=V(e);for(let a=0;a<c;a++){const v=o==="up"?[...n[a]]:[...n[a]].reverse(),g=t(v),l=o==="up"?g.newRow:g.newRow.reverse();n[a].join(",")!==l.join(",")&&(f=!0),r+=g.mergeScore,n[a]=l}Object.assign(e,V(n))}let i=0;if(f)for(let n=0;n<c;n++)for(let a=0;a<c;a++)e[n][a]===0&&i++;return{moved:f,score:r,emptyCells:i}}function ve(){const o=["up","down","left","right"];let e=null,r=-1,f=-1;return o.forEach(t=>{const i=ye(t);i.moved&&(i.score>r?(r=i.score,f=i.emptyCells,e=t):i.score===r&&i.emptyCells>f&&(f=i.emptyCells,e=t))}),console.log("Best move calculated:",e,"Score:",r,"Empty Cells:",f),e}function we(){if(B||L)return;const o=ve();if(o){let e=null;switch(o){case"up":e=fe(u);break;case"down":e=de(u);break;case"left":e=ae(u);break;case"right":e=ce(u);break}e&&e.moved?ue(e.actions,e.finalGrid,e.scoreIncrease).catch(r=>{console.error("Help Animation failed:",r),L=!1,u=e.finalGrid,H+=e.scoreIncrease,ee(),Y(),!q()&&!W()&&F()}):console.warn("Help button suggested a move, but calculation resulted in no change? Move:",o)}else console.log("Help button: No beneficial moves found.")}document.addEventListener("DOMContentLoaded",()=>{me(),se(),console.log("Game initialized"),console.log(u),document.addEventListener("keydown",pe);const o=document.getElementById("help-button");o?o.addEventListener("click",we):console.error("Help button not found!");const e=document.getElementById("test-game-over-button");e?e.addEventListener("click",he):console.warn("Test Game Over button not found!")});function he(){B||(console.log("Setting up test game over state..."),u=[[2,4,8,16],[4,8,16,32],[8,16,32,64],[16,32,64,128]],H=1e3,B=!1,Y(),ee(),!q()&&!W()&&F())}
